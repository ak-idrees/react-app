name: Deploy React App via Jenkins

on:
  repository_dispatch:
    types: [jenkins_build_complete]

jobs:
  deploy:
    runs-on: ubuntu-latest
    env:
      DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
      DOCKERHUB_PASS: ${{ secrets.DOCKERHUB_PASS }}

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Pull Docker Image
        run: |
          docker login -u $DOCKERHUB_USERNAME -p $DOCKERHUB_PASS
          IMAGE=$DOCKERHUB_USERNAME/simple-reactjs-app:${GITHUB_SHA}
          docker pull $IMAGE

      - name: Deploy Container
        run: |
          SERVICE="dep-frontend"   # or dynamic based on tag
          CLIENT="client1"         # you can pass via payload if needed
          CONTAINER_NAME="react-${SERVICE}-${CLIENT}"
          PORT=3001

          docker stop $CONTAINER_NAME || true
          docker rm $CONTAINER_NAME || true

          docker run -d \
            --name $CONTAINER_NAME \
            --restart unless-stopped \
            -p $PORT:3000 \
            $IMAGE
